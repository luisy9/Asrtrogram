---
import Layout from "../layouts/Layout.astro";

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const name = data.get("name");
    const password = data.get("password");

    const url = "http://localhost:3000/api";

    //Consulta POST a la api para hacer un login
    const login = await fetch(`${url}/login`, {
      method: "POST",
      credentials: "include",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ name: name, password: password }),
    })
      .then((res) => res.json())
      .then((user) => Astro.cookies.set("cookie", user?.token))
      .catch((error) => console.log(error));

    //Redirect if si hay una cookie
    if (Astro.cookies.has("cookie")) {
      return Astro.redirect("/");
    }
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}
---

<Layout>
  <div class="w-full h-screen bg-[#0F1218]">
    <div class="">
      <div class="w-full h-screen flex justify-center items-center">
        <div class="w-11/12 h-2/6">
          <div class="flex justify-center pb-20">
            <h1 class="text-8xl text-semibold text-white">Astrogram</h1>
          </div>
          <form method="POST">
            <div class="rounded-md py-2 px-5">
              <div
                class="flex flex-col items-center justify-center gap-12 w-full py-5"
              >
                <div class="w-full">
                  <input
                    type="text"
                    class="text-4xl px-4 py-8 border rounded-lg border-white bg-transparent w-full
                    placeholder:px-1 placeholder:font-thin text-[#FFFF] placeholder:text-[#8F8F8F] placeholder:text-4xl"
                    placeholder="User name"
                    name="name"
                  />
                </div>
                <div class="w-full">
                  <input
                    type="password"
                    class="px-4 border py-8 rounded-lg border-white bg-transparent w-full text-[#FFFF]
                  placeholder:px-1 placeholder:font-thin placeholder:text-[#8F8F8F] placeholder:text-4xl text-4xl"
                    placeholder="Password"
                    name="password"
                  />
                </div>
                <div class="w-full flex">
                  <button
                    class="text-5xl py-8 text-black border rounded-lg w-full bg-white"
                  >
                    <div class="flex justify-center items-center gap-2">
                      <div class="">
                        <svg
                          class="w-16 h-16 text-gray-800"
                          aria-hidden="true"
                          xmlns="http://www.w3.org/2000/svg"
                          width="24"
                          height="24"
                          fill="none"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="1.5"
                            d="m10.051 8.102-3.778.322-1.994 1.994a.94.94 0 0 0 .533 1.6l2.698.316m8.39 1.617-.322 3.78-1.994 1.994a.94.94 0 0 1-1.595-.533l-.4-2.652m8.166-11.174a1.366 1.366 0 0 0-1.12-1.12c-1.616-.279-4.906-.623-6.38.853-1.671 1.672-5.211 8.015-6.31 10.023a.932.932 0 0 0 .162 1.111l.828.835.833.832a.932.932 0 0 0 1.111.163c2.008-1.102 8.35-4.642 10.021-6.312 1.475-1.478 1.133-4.77.855-6.385Zm-2.961 3.722a1.88 1.88 0 1 1-3.76 0 1.88 1.88 0 0 1 3.76 0Z"
                          ></path>
                        </svg>
                      </div>
                      Login
                    </div>
                  </button>
                </div>
                <div class="flex items-center gap-3">
                  <!--?xml version="1.0" encoding="UTF-8"?-->
                  <svg
                    width="24px"
                    height="24px"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    color="#000000"
                    ><path
                      d="M21 12L3 12M3 12L11.5 3.5M3 12L11.5 20.5"
                      stroke="#FFFFF"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path></svg
                  >
                  <a
                    href="/register"
                    class="text-[2.8rem] bg-gradient-to-r text-transparent bg-clip-text from-10% from-indigo-500 via-purple-500 to-pink-300"
                    >No tienes cuenta? Registrate</a
                  >
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</Layout>
